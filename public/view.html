<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù - Ù…Ø´Ø§Ø±ÙƒØ© PDF</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container { 
      max-width: 1000px; 
      margin: auto; 
      background: white; 
      border-radius: 20px; 
      box-shadow: 0 20px 60px rgba(0,0,0,0.15);
      overflow: hidden;
      position: relative;
    }

    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #3498db, #2ecc71, #f39c12, #e74c3c);
    }

    .header {
      background: linear-gradient(45deg, #f8f9fa, #ffffff);
      padding: 40px;
      text-align: center;
      border-bottom: 1px solid #e9ecef;
    }
    
    .header h1 { 
      color: #2c3e50; 
      margin-bottom: 10px;
      font-size: 2.5rem;
      font-weight: 700;
    }

    .header p {
      color: #7f8c8d;
      font-size: 1.1rem;
    }
    
    .file-info {
      padding: 40px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      align-items: start;
    }

    .info-card {
      background: linear-gradient(45deg, #f8f9fa, #ffffff);
      padding: 30px;
      border-radius: 15px;
      border: 2px solid #e9ecef;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    .info-card h3 {
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .info-item {
      margin-bottom: 15px;
      padding: 10px 0;
      border-bottom: 1px solid #ecf0f1;
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-label {
      color: #34495e;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .info-value {
      color: #2c3e50;
      font-size: 1.1rem;
    }

    .file-size-large {
      font-size: 2rem;
      font-weight: bold;
      color: #3498db;
    }

    .actions {
      padding: 40px;
      background: #f8f9fa;
      text-align: center;
    }

    .btn { 
      background: linear-gradient(45deg, #3498db, #2980b9);
      color: white; 
      padding: 15px 30px; 
      border: none; 
      border-radius: 25px; 
      cursor: pointer; 
      font-size: 1.1rem;
      margin: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }
    
    .btn:hover { 
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
    }

    .btn-success {
      background: linear-gradient(45deg, #27ae60, #2ecc71);
      box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
    }

    .btn-success:hover {
      box-shadow: 0 8px 25px rgba(46, 204, 113, 0.4);
    }

    .btn-secondary {
      background: linear-gradient(45deg, #95a5a6, #7f8c8d);
      box-shadow: 0 4px 15px rgba(149, 165, 166, 0.3);
    }

    .btn-secondary:hover {
      box-shadow: 0 8px 25px rgba(149, 165, 166, 0.4);
    }

    .pdf-preview {
      margin-top: 30px;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }

    .pdf-frame {
      width: 100%;
      height: 600px;
      border: none;
      border-radius: 15px;
    }

    .error-message {
      background: linear-gradient(45deg, #fadbd8, #ffffff);
      color: #e74c3c;
      border: 2px solid #e74c3c;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      text-align: center;
    }

    .loading {
      text-align: center;
      padding: 50px;
      color: #7f8c8d;
    }

    .loading-spinner {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .back-link {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.9);
      color: #3498db;
      padding: 10px 20px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .back-link:hover {
      background: rgba(255, 255, 255, 1);
      transform: scale(1.05);
    }

    @media (max-width: 768px) {
      .container {
        margin: 10px;
      }
      
      .header {
        padding: 20px;
      }

      .header h1 {
        font-size: 2rem;
      }
      
      .file-info {
        grid-template-columns: 1fr;
        padding: 20px;
        gap: 20px;
      }

      .info-card {
        padding: 20px;
      }

      .actions {
        padding: 20px;
      }

      .btn {
        width: 100%;
        margin: 5px 0;
        justify-content: center;
      }

      .pdf-frame {
        height: 400px;
      }

      .back-link {
        position: static;
        display: inline-block;
        margin-bottom: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="/" class="back-link">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    
    <div class="header">
      <h1>ğŸ“„ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù</h1>
      <p>ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù ÙˆØªØ­Ù…ÙŠÙ„Ù‡ Ù…Ù† Ù‡Ù†Ø§</p>
    </div>

    <div id="loading" class="loading">
      <div class="loading-spinner"></div>
      <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù...</p>
    </div>

    <div id="content" style="display: none;">
      <div class="file-info">
        <div class="info-card">
          <h3>ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù</h3>
          <div class="info-item">
            <div class="info-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù:</div>
            <div class="info-value" id="fileName">--</div>
          </div>
          <div class="info-item">
            <div class="info-label">Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù:</div>
            <div class="info-value file-size-large" id="fileSize">--</div>
          </div>
          <div class="info-item">
            <div class="info-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù:</div>
            <div class="info-value">PDF Document</div>
          </div>
          <div class="info-item">
            <div class="info-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±ÙØ¹:</div>
            <div class="info-value" id="uploadDate">--</div>
          </div>
        </div>

        <div class="info-card">
          <h3>ğŸ”— Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„</h3>
          <div class="info-item">
            <div class="info-label">Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø¨Ø§Ø´Ø±Ø©:</div>
            <div class="info-value">
              <a href="#" id="viewLink" class="btn btn-secondary" target="_blank">
                ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù
              </a>
            </div>
          </div>
          <div class="info-item">
            <div class="info-label">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù:</div>
            <div class="info-value">
              <a href="#" id="downloadLink" class="btn btn-success">
                â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ PDF
              </a>
            </div>
          </div>
          <div class="info-item">
            <div class="info-label">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ø§Ø¨Ø·:</div>
            <div class="info-value">
              <button class="btn" onclick="shareFile()">
                ğŸ“± Ù…Ø´Ø§Ø±ÙƒØ©
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="actions">
        <h3 style="margin-bottom: 20px; color: #2c3e50;">Ø®ÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h3>
        <button class="btn" onclick="copyLink()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
        <button class="btn btn-secondary" onclick="printFile()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
        <a href="/" class="btn btn-secondary">â¬†ï¸ Ø±ÙØ¹ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯</a>
      </div>

      <div class="pdf-preview">
        <iframe id="pdfFrame" class="pdf-frame" src=""></iframe>
      </div>
    </div>

    <div id="errorMessage" class="error-message" style="display: none;">
      <h3>âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</h3>
      <p>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ ØªÙ… Ø­Ø°ÙÙ‡.</p>
      <a href="/" class="btn" style="margin-top: 20px;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>
  </div>

  <script>
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ù…Ù† URL
    const pathParts = window.location.pathname.split('/');
    const filename = pathParts[pathParts.length - 1];
    
    console.log('Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù:', filename);

    // ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù
    async function loadFileInfo() {
      try {
        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯Ù‡
        const response = await fetch(`/api/file-info/${filename}`);
        
        if (!response.ok) {
          throw new Error('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        }
        
        const fileInfo = await response.json();
        displayFileInfo(fileInfo);
        
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù:', error);
        showError();
      }
    }

    function displayFileInfo(info) {
      // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
      document.getElementById('loading').style.display = 'none';
      document.getElementById('content').style.display = 'block';
      
      // ØªØ¹Ø¨Ø¦Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù
      document.getElementById('fileName').textContent = info.originalName || filename;
      document.getElementById('fileSize').textContent = formatFileSize(info.size);
      document.getElementById('uploadDate').textContent = formatDate(info.uploadDate);
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
      const baseUrl = window.location.origin;
      const fileUrl = `${baseUrl}/files/${filename}`;
      const downloadUrl = `${fileUrl}?display=download`;
      
      document.getElementById('viewLink').href = fileUrl;
      document.getElementById('downloadLink').href = downloadUrl;
      document.getElementById('pdfFrame').src = fileUrl;
      
      console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­');
    }

    function showError() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('errorMessage').style.display = 'block';
    }

    function formatFileSize(bytes) {
      if (!bytes) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      if (bytes === 0) return '0 Ø¨Ø§ÙŠØª';
      
      const k = 1024;
      const sizes = ['Ø¨Ø§ÙŠØª', 'ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª', 'Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª', 'Ø¬ÙŠØ¬Ø§Ø¨Ø§ÙŠØª'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function formatDate(dateString) {
      if (!dateString) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      
      const date = new Date(dateString);
      const now = new Date();
      const diffTime = Math.abs(now - date);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      if (diffDays === 1) {
        return 'Ø§Ù„ÙŠÙˆÙ…';
      } else if (diffDays === 2) {
        return 'Ø£Ù…Ø³';
      } else if (diffDays <= 7) {
        return `Ù…Ù†Ø° ${diffDays} Ø£ÙŠØ§Ù…`;
      } else {
        return date.toLocaleDateString('ar-SA');
      }
    }

    async function copyLink() {
      try {
        await navigator.clipboard.writeText(window.location.href);
        
        // ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ
        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.innerHTML = 'âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®!';
        btn.style.background = 'linear-gradient(45deg, #27ae60, #2ecc71)';
        
        setTimeout(() => {
          btn.innerHTML = originalText;
          btn.style.background = 'linear-gradient(45deg, #3498db, #2980b9)';
        }, 2000);
        
      } catch (err) {
        console.error('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·:', err);
        alert('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·. Ø§Ù†Ø³Ø®Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†.');
      }
    }

    async function shareFile() {
      if (navigator.share) {
        try {
          await navigator.share({
            title: 'Ù…Ù„Ù PDF',
            text: 'Ø´Ø§Ù‡Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù',
            url: window.location.href
          });
        } catch (err) {
          if (err.name !== 'AbortError') {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:', err);
            copyLink();
          }
        }
      } else {
        copyLink();
      }
    }

    function printFile() {
      const printWindow = window.open(`/files/${filename}`, '_blank');
      printWindow.onload = function() {
        setTimeout(() => {
          printWindow.print();
        }, 1000);
      };
    }

    // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©
    async function init() {
      try {
        await loadFileInfo();
      } catch (error) {
        // ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ APIØŒ Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©
        console.log('Ù„Ø§ ÙŠÙˆØ¬Ø¯ API Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„ÙØŒ Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©');
        
        const basicInfo = {
          originalName: filename,
          size: null,
          uploadDate: new Date().toISOString()
        };
        
        displayFileInfo(basicInfo);
      }
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    init();
  </script>
</body>
</html>
